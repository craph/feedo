# - name : input_file
#   watch_path : "/input/pihole"
#   path_pattern : "/input/pihole/jarvis*/netflow.*.log"
#   remove: True
#   tag : netflow

- name : dummy
  tag : netflow
  data :
   - {"log" : '2020-12-02T18:21:21+00:00	netflow	{"tag":"netflow","log":"{''first_switched'': 465409000, ''last_switched'': 465414000, ''bytes'': 4369, ''packets'': 18, ''src_addres'': ''37.59.37.5'', ''src_port'': 36028, ''dst_address'': ''192.168.0.251'', ''dst_port'': 24000, ''flow_id'': ''05733b4c234663c19e56ad687506ee881856e96464f1a4397c5ea56b897b6c55'', ''nexthop'': ''192.168.1.254'', ''protocol'': ''TCP'', ''TCP_flags'': 27, ''TCP_flags_decoded'': ''ACK,SYN,FIN,PSH'', ''TOS'': 0, ''src_AS'': 0, ''dst_AS'': 0, ''client_ip'': ''192.168.0.1'', ''client_port'': 54868}","source":"jarvis-2","timestamp":1606933281}'}

- name : parser_regex
  key : log
  regex : ".+?(?P<json>\\{.+\\})"
  match : netflow

- name : parser_json
  key : json
  mode : merge
  match : netflow

- name : remove_keys
  keys : 
    - tag
  match : netflow

- name : stdout
  match : netflow

# - name : archive
#   time_key : timestamp
#   path_template : "/archives/pihole/{source}/netflow-%Y%m%d.json"
#   buffer_size : 1000
#   match : netflow

# - name : rethinkdb
#   time_key : timestamp
#   table_template : "jarvis-netflow-%Y%m%d"
#   buffer_size : 1000
#   database : test
#   ip : rethink
#   port : 28015
#   match : netflow

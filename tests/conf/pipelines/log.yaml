# - name : input_file
#   watch_path : "/input/pihole"
#   path_pattern : "/input/pihole/jarvis*/log.*.log"
#   remove: True
#   tag : log

- name : dummy
  tag : log
  data :
   - {"log" : '2020-12-01T10:36:42+00:00       log.auth        {"timestamp":1606819002,"tag":"log.auth","log":"Dec  1 11:36:42 jarvis-1 sudo: pam_unix(sudo:session): session opened for user root by (uid=0)","source":"jarvis-1"}'}
   - {"log" : '2020-12-01T10:37:37+00:00       log.ufw {"timestamp":1606819057,"tag":"log.ufw","log":"Dec  1 11:36:48 jarvis-1 kernel: [ 5285.777558] [UFW BLOCK] IN=docker0 OUT=docker0 PHYSIN=veth9c47e95 PHYSOUT=vethb022943 MAC=33:33:00:00:00:16:82:bb:a5:ae:25:7d:86:dd SRC=0000:0000:0000:0000:0000:0000:0000:0000 DST=ff02:0000:0000:0000:0000:0000:0000:0016 LEN=96 TC=0 HOPLIMIT=1 FLOWLBL=0 PROTO=ICMPv6 TYPE=143 CODE=0 ","source":"jarvis-1"}'}

- name : parser_regex
  key : log
  regex : ".+?log\\.(?P<type>\\w+).+?(?P<json>\\{.+\\})"
  match : log

- name : parser_json
  key : json
  mode : merge
  match : log

- name : remove_keys
  keys : 
    - tag
  match : log

- name : stdout
  match : log

# - name : archive
#   time_key : timestamp
#   path_template : "/archives/pihole/{source}/log-%Y%m%d.json"
#   buffer_size : 1000
#   match : log

# - name : rethinkdb
#   time_key : timestamp
#   table_template : "jarvis-log-%Y%m%d"
#   buffer_size : 1000
#   database : test
#   ip : rethink
#   port : 28015
#   match : log
